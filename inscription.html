<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Inscription — AllergoZyme Passport</title>
<link rel="icon" href="logo.png"/>

<style>
:root{
  --black:#0a0a0a; --black2:#0d0d0e; --black3:#131316; --black4:#0b0b0c;
  --ink:#e7e7ea; --mute:#a8a8b6; --gold:#b6952a; --line:#202024;
  --r:22px;
}
*{box-sizing:border-box; font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}

body{
  margin:0; background:var(--black); color:var(--ink);
  display:flex; flex-direction:column; min-height:100vh;
}
.gridbg{position:fixed; inset:-20vh -20vw; z-index:0;
  background:
    radial-gradient(800px 400px at 50% -10%, rgba(183,149,42,.08), transparent 60%),
    repeating-linear-gradient(0deg, rgba(255,255,255,.03) 0 1px, transparent 1px 80px),
    repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 1px, transparent 1px 80px);
  mask-image: radial-gradient(80% 60% at 50% 40%, black, transparent);
  animation: drift 60s linear infinite;
}
.noise{position:fixed; inset:0; pointer-events:none; z-index:0; opacity:.28; mix-blend-mode:soft-light;
  background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/><feComponentTransfer><feFuncA type="table" tableValues="0 0 0 .05 .12 .05 0 0"/></feComponentTransfer></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');
}
@keyframes drift{to{transform:translate3d(-30px,-20px,0)}}

header{position:sticky; top:0; z-index:40; backdrop-filter:blur(10px); background:rgba(10,10,10,.6); border-bottom:1px solid var(--line); padding:14px 22px; display:flex; justify-content:space-between; align-items:center}
.brand{display:flex; align-items:center; gap:12px}
.brand img{width:40px; height:40px; border-radius:8px; object-fit:contain}
.brand h1{margin:0; font-size:.9rem; letter-spacing:.12em; font-weight:900; text-transform:uppercase; color:#fff}
.nav-actions a{color:var(--ink); padding:8px 16px; border:1px solid var(--line); border-radius:999px; font-size:.86rem; background:linear-gradient(180deg,var(--black2),var(--black3)); text-decoration:none}
.nav-actions a:hover{box-shadow:0 6px 24px rgba(182,149,42,.28)}

.main-center{flex:1; display:block; padding:40px 18px}

.card{
  margin:60px auto;
  background:linear-gradient(180deg,var(--black2),var(--black3));
  border:1px solid var(--line); border-radius:var(--r); padding:42px 34px; width:100%; max-width:420px;
  box-shadow:0 22px 68px rgba(182,149,42,.18); text-align:center; position:relative; z-index:2
}
.card img{width:80px; margin-bottom:14px}
h1{margin:0 0 22px; font-size:1.4rem}
label{display:block; text-align:left; font-size:.82rem; margin-bottom:6px; color:var(--mute)}
input{
  width:100%; padding:12px; border-radius:10px; border:1px solid var(--line); background:#0b0b0c; color:var(--ink); margin-bottom:16px
}
input:focus{outline:none; border-color:var(--gold); box-shadow:0 0 0 2px rgba(182,149,42,.32)}

.btn-primary{
  width:100%; padding:14px; border-radius:999px; border:none;
  background:linear-gradient(180deg,#b6952a,#9c8024); color:#fff; font-weight:700; cursor:pointer
}
.btn-primary:hover{box-shadow:0 12px 36px rgba(182,149,42,.35)}

.errorMsg{text-align:center; color:#ff5252; font-size:.82rem; margin-top:10px;display:none}
</style>
</head>
<body>

<div class="gridbg"></div>
<div class="noise"></div>

<header>
  <div class="brand">
    <img src="logo.png" alt="logo"/>
    <h1>AllergoZyme Passport</h1>
  </div>
  <div class="nav-actions">
    <a href="identification.html">Se connecter</a>
    <a href="index.html">Accueil</a>
  </div>
</header>

<div class="main-center">
  <div class="card">
    <img src="logo.png" alt="AllergoZyme Logo"/>
    <h1>Créer votre compte</h1>

    <form id="form">
      <label>Nom</label>
      <input id="nom" required>

      <label>Prénom</label>
      <input id="prenom" required>

      <label>Email (PayPal)</label>
      <input id="email" type="email" required>

      <label>Mot de passe</label>
      <input id="password" type="password" required minlength="6">

      <button class="btn-primary">S’inscrire</button>
      <div class="errorMsg" id="err"></div>
    </form>

  </div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"

const supabase = createClient(
 "https://tmrraeutjrcsozijjbzm.supabase.co",
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRtcnJhZXV0anJjc296aWpqYnptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4MDA4NzIsImV4cCI6MjA3NjM3Njg3Mn0.015qUFsUyndsesz5RHGKWO1Ipoz7C3vcVZulACGmq0g"
)

function code(){ const L="ABCDEFGHIJKLMNOPQRSTUVWXYZ";return L[Math.floor(Math.random()*26)]+L[Math.floor(Math.random()*26)]+"-"+Math.floor(1000+Math.random()*9000)}

form.addEventListener("submit", async e=>{
 e.preventDefault()

 const nom=document.getElementById("nom").value.trim()
 const prenom=document.getElementById("prenom").value.trim()
 const email=document.getElementById("email").value.trim()
 const password=document.getElementById("password").value.trim()

 const codePromo = code()
 const fullName = prenom+" "+nom

 const { error:signupError, data } = await supabase.auth.signUp({
  email,password,
  options:{data:{nom:fullName}}
 })

 if(signupError){err.textContent="❌ "+signupError.message;err.style.display="block";return}

 await supabase.from("vendeurs").insert([{nom:fullName,email,paypal_email:email,code_promo:codePromo,created_at:new Date().toISOString()}])

// auto login
await supabase.auth.signInWithPassword({ email, password })

// redirect final
window.location.href="dashboard.html"

})
</script>

</body>
</html>
