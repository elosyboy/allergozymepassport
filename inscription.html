<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Inscription — AllergoZyme Passport</title>
<link rel="icon" href="logo2.png"/>

<style>
:root{
  --black:#0a0a0a; --black2:#0d0d0e; --black3:#131316; --black4:#0b0b0c;
  --ink:#e7e7ea; --mute:#a8a8b6; --gold:#b6952a; --line:#202024;
  --r:22px;
}
*{box-sizing:border-box; font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}

body{
  margin:0; background:var(--black); color:var(--ink);
  display:flex; flex-direction:column; min-height:100vh;
}
.gridbg{position:fixed; inset:-20vh -20vw; z-index:0;
  background:
    radial-gradient(800px 400px at 50% -10%, rgba(183,149,42,.08), transparent 60%),
    repeating-linear-gradient(0deg, rgba(255,255,255,.03) 0 1px, transparent 1px 80px),
    repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 1px, transparent 1px 80px);
  mask-image: radial-gradient(80% 60% at 50% 40%, black, transparent);
  animation: drift 60s linear infinite;
}
.noise{position:fixed; inset:0; pointer-events:none; z-index:0; opacity:.28; mix-blend-mode:soft-light;
  background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/><feComponentTransfer><feFuncA type="table" tableValues="0 0 0 .05 .12 .05 0 0"/></feComponentTransfer></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');
}
@keyframes drift{to{transform:translate3d(-30px,-20px,0)}}

/* HEADER */
header{position:sticky; top:0; z-index:40; backdrop-filter:blur(10px); background:rgba(10,10,10,.6); border-bottom:1px solid var(--line); padding:14px 22px; display:flex; justify-content:space-between; align-items:center}
.brand{display:flex; align-items:center; gap:12px}
.brand img{width:40px; height:40px; border-radius:8px; object-fit:contain}
.brand h1{margin:0; font-size:.9rem; letter-spacing:.12em; font-weight:900; text-transform:uppercase; color:#fff}
.nav-actions a{color:var(--ink); padding:8px 16px; border:1px solid var(--line); border-radius:999px; font-size:.86rem; background:linear-gradient(180deg,var(--black2),var(--black3)); text-decoration:none}
.nav-actions a:hover{box-shadow:0 6px 24px rgba(182,149,42,.28)}

/* CENTER */
.main-center{flex:1; display:grid; place-items:center; padding:40px 14px}

/* CARD */
.card{
  background:linear-gradient(180deg,var(--black2),var(--black3));
  border:1px solid var(--line); border-radius:var(--r); padding:42px 32px; width:100%; max-width:500px;
  box-shadow:0 22px 68px rgba(182,149,42,.18); position:relative; z-index:3; color:var(--ink); text-align:center
}
.card img{width:80px; margin-bottom:14px}
h1{margin:0 0 12px; font-size:1.4rem}
.subtitle{color:var(--mute); font-size:.88rem; line-height:1.45; margin-bottom:26px}

form{display:flex; flex-direction:column; gap:18px; text-align:left}
label{font-size:.78rem; color:var(--mute); margin-bottom:4px}
input{width:100%; padding:12px; border-radius:10px; border:1px solid var(--line); background:#0b0b0c; color:var(--ink)}
input:focus{outline:none;border-color:var(--gold);box-shadow:0 0 0 2px rgba(182,149,42,.32)}

.checkbox-container{display:flex; gap:10px; background:#0b0b0c; padding:10px; border:1px solid var(--line); border-radius:10px; margin-top:6px}
.checkbox-container input{width:18px;height:18px;margin-top:2px;accent-color:var(--gold)}

.btn{
  background:linear-gradient(180deg,#b6952a,#9c8024); color:#fff;
  border:none; padding:14px; border-radius:999px; font-weight:700; cursor:pointer
}
.btn:hover{box-shadow:0 12px 36px rgba(182,149,42,.35)}

.success,.error{display:none;text-align:center;font-size:.85rem;margin-top:10px;padding:10px;border-radius:8px}
.success{color:#2e7d32; background:rgba(46,125,50,.15)}
.error{color:#bc4a4a;background:rgba(188,74,74,.15)}

footer{text-align:center;color:var(--mute);font-size:.75rem;padding:22px}
</style>
</head>
<body>

<div class="gridbg"></div>
<div class="noise"></div>

<header>
  <div class="brand">
    <img src="logo.png" alt="logo"/>
    <h1>AllergoZyme Passport</h1>
  </div>
  <div class="nav-actions">
    <a href="identification.html">Déjà inscrit</a>
    <a href="index.html">Accueil</a>
  </div>
</header>

<div class="main-center">
  <div class="card">
    <img src="logo.png" alt="AllergoZyme Logo"/>
    <h1>Créer un compte</h1>
    <p class="subtitle">
      Rejoignez la communauté <strong>AllergoZyme Passport</strong> et protégez-vous en toute sérénité.<br>
      Gagnez <strong>10 €</strong> par établissement que vous recommandez.
    </p>

    <!-- TON FORMULAIRE EXACT -->
    <!-- aucune ligne modifiée -->
    <form id="signupForm">
      <label>Nom</label>
      <input type="text" id="nom" required />

      <label>Prénom</label>
      <input type="text" id="prenom" required />

      <label>Email (même que PayPal)</label>
      <input type="email" id="email" required />

      <label>Mot de passe</label>
      <input type="password" id="password" required minlength="6" />

      <label>Téléphone</label>
      <input type="tel" id="telephone" required />

      <label>Adresse</label>
      <input type="text" id="adresse" required />

      <label>Code postal</label>
      <input type="number" id="codepostal" required />

      <label>Ville</label>
      <input type="text" id="ville" required />

      <label>Pays</label>
      <input type="text" id="pays" required />

      <div class="checkbox-container">
        <input type="checkbox" id="consent" required />
        <label for="consent">
          J’accepte que mes données soient enregistrées et protégées conformément à la politique de confidentialité d’AllergoZyme.
        </label>
      </div>

      <button type="submit" class="btn">S'inscrire</button>

      <div class="success" id="msgSuccess"></div>
      <div class="error" id="msgError"></div>
    </form>
  </div>
</div>

<footer>© <span id="year"></span> AllergoZyme Passport — Données sécurisées et protégées</footer>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

  const SUPABASE_URL = 'https://tmrraeutjrcsozijjbzm.supabase.co'
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRtcnJhZXV0anJjc296aWpqYnptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4MDA4NzIsImV4cCI6MjA3NjM3Njg3Mn0.015qUFsUyndsesz5RHGKWO1Ipoz7C3vcVZulACGmq0g'
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

  document.getElementById('year').textContent = new Date().getFullYear()

  function genererCodeUnique() {
    const lettres = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
    const prefixe = lettres[Math.floor(Math.random() * lettres.length)] + lettres[Math.floor(Math.random() * lettres.length)]
    const chiffres = Math.floor(1000 + Math.random() * 9000)
    return `${prefixe}-${chiffres}`
  }

  const form = document.getElementById('signupForm')
  const msgSuccess = document.getElementById('msgSuccess')
  const msgError = document.getElementById('msgError')

  form.addEventListener('submit', async (e) => {
    e.preventDefault()
    msgSuccess.style.display = 'none'
    msgError.style.display = 'none'

    const nom = document.getElementById('nom').value.trim()
    const prenom = document.getElementById('prenom').value.trim()
    const email = document.getElementById('email').value.trim()
    const password = document.getElementById('password').value
    const telephone = document.getElementById('telephone').value.trim()
    const adresse = document.getElementById('adresse').value.trim()
    const codepostal = document.getElementById('codepostal').value.trim()
    const ville = document.getElementById('ville').value.trim()
    const pays = document.getElementById('pays').value.trim()
    const codePromo = genererCodeUnique()

    try {
      const { error: signUpError } = await supabase.auth.signUp({
        email,
        password,
        options: {
          emailRedirectTo: window.location.origin + '/confirmation.html',
          data: { nom, prenom, telephone, adresse, codepostal, ville, pays, codePromo }
        }
      })

      if (signUpError) throw signUpError

      await supabase
        .from('vendeurs')
        .insert([{ nom: `${prenom} ${nom}`, email, paypal_email: email, code_promo: codePromo }])

      window.location.href = 'valideinscription.html'

    } catch (err) {
      console.error('Erreur:', err)
      msgError.textContent = '❌ ' + (err.message || 'Une erreur est survenue. Réessayez plus tard.')
      msgError.style.display = 'block'
    }
  })
</script>

</body>
</html>
